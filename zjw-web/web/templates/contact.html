{% extends 'base.html' %}
{% load staticfiles %}

{% block css %}
<link href="{% static 'styles/contact.css' %}" rel="stylesheet" media="screen" />
{% endblock css %}

{% block main %}	
<article>
	<div class="row">
		<div class="col-md-6 col-sm-8 col-xs-12 col-md-push-3 col-sm-push-2">
			<form id="contact_form" role="form" action="{% url 'comments:contact' %}" method="post" >
				{% csrf_token %}
				<fieldset>
					<legend>评论</legend>
					<div class="form-group">
						<label for="{{ form.content.id_for_label }}">发送的消息</label>
						{{form.content}}
						{{form.content.errors}}
					</div>
					<div class="form-group" id='check'>
						<div>
							<div class="type">
								<label for="{{ form.public.id_for_label }}">
									{{form.public}}
									{{form.public.errors}}
									公开
								</label>
								<label for="{{ form.important.id_for_label }}">
									{{form.important}}
									{{form.important.errors}}
									重要
								</label>
							</div>
							<div class="captcha1">
								{{form.captcha}}
								{{form.captcha.errors}}
							</div>
						</div>
					</div>
					<input name="author" type="hidden" value="{{request.user.id}}" />
					<button type="submit" class="btn btn-default">提交</button>
				</fieldset>
			</form>
			<div class="modal fade" id="Modal" aria-labelledby="myModal" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="myModal">注意</h4>
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						</div>
						<div class="modal-body">评论前需要先登录，现在登录？</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-danger" id="modal-login">登录</button>
						</div>
					</div>
				</div>
			</div>
			{% if response %}
				<div class="alert alert-success alert-dismissable">
				提交成功！您发送的消息将会出现在下方的评论栏中，敬请关注
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				</div>
			{% endif %}
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<h3 id="well">评论区</h3>
			<div class="well comment_well">
				<ul class="media-list">
				{% for comment in comment_list %}
					<li class="media">
						<a href="{% url 'users:info' %}?name={{comment.author.username}}" class="media-left">
							<img src="{{comment.author.pic.url}}" class="media-object img-circle" alt="photo" />
						</a>
						<div class="media-body">
							<h4 class="media-heading">{{comment.author.username}}</h4>
							<p>{{comment.content}}</p>
							<a href="#comment_{{comment.id}}" class="reply_button" data-toggle="collapse" reply="{{comment.author.username}}">回复</a>
							<span class="pull-right">{{comment.created_time}}</span>
							<div id="comment_{{comment.id}}" class="collapse reply_form">
							</div>
							{% for reply in comment.reply_set.all %}
							<div class="media">
								<a href="{% url 'users:info' %}?name={{reply.author.username}}" class="media-left">
									<img src="{{reply.author.pic.url}}" class="media-object img-circle" alt="photo" />
								</a>
								<div class="media-body">
									<h4 class="media-heading">{{reply.author.username}}</h4>
									<p>{{reply.content}}</p>
									<a href="#reply_{{reply.id}}" class="reply_button" reply="{{reply.author.username}}">回复</a>
									<span class="pull-right">{{reply.created_time}}</span>
									<div id="reply_{{reply.id}}" class="collapse well">
										这是回复表单所在的地方
									</div>
								</div>
							</div>
							{% endfor %}
						</div>
					</li>
					<hr class="comment_line" />
				{% empty %}
				暂无评论
				{% endfor %}
				</ul>
			</div>
		</div>
	</div>
</article>
{% endblock main %}